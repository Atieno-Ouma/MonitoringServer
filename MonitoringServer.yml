---
- name: Initial Setup
  hosts: local
  become: yes
  
  tasks:
  - name: Update and Install Dependancies
    apt:
      update_cache: yes
      pkg:
      - apt-transport-https
      - ca-certificates
      - curl

- name: Nessus Setup
  hosts: local
  become: yes

  tasks:
  - name: Bring Up Nessus
    docker_container:
      name: nessus
      image: tbconsulting/nessus:1.0
      ports:
        - 8834:8834


- name: UF Setup
  hosts: local
  become: yes
  
  tasks:
  - name: git pull deb file
    git:
      repo: https://github.com/tbcsec/Splunkforwarder.git
      dest: /home/dakota/MonitoringServer

  - name: apt install UF
    apt:
      deb: /home/dakota/MonitoringServer/splunkforwarder-8.0.3-a6754d8441bf-linux-2.6-amd64.deb

  - name: start splunk
    command: chdir=/opt/splunkforwarder/bin ./splunk start --accept-license

  
- name: Suricata Setup
  hosts: local
  become: yes
  
  tasks:

  - name: Update and Install Dependancies
    apt:
      update_cache: yes
      pkg:
      - libpcre3-dbg
      - libpcre3-dev
      - autoconf 
      - automake 
      - libtool 
      - libpcap-dev 
      - libnet1-dev 
      - libyaml-dev 
      - libjansson4 
      - libcap-ng-dev 
      - libmagic-dev 
      - libjansson-dev 
      - zlib1g-dev 
      - pkg-config 
      - rustc 
      - cargo
      - python-apt

  - name: wget Suricata tar file
    command: chdir=/home/dakota/SecurityPostureAssessment wget https://www.openinfosecfoundation.org/download/suricata-5.0.0.tar.gz

  - name: Untar file
    command: chdir=/home/dakota/SecurityPostureAssessment tar -xvzf suricata-5.0.0.tar.gz 
  
  - name: copy files over to /etc/suricata
    command: chdir=/home/dakota/SecurityPostureAssessment/suricata-5.0.0/etc cp reference.config /etc/suricata

  - name: copy files over over to /etc/suricata
    command: chdir=/home/dakota/SecurityPostureAssessment/suricata-5.0.0/etc cp classification.config /etc/suricata

  - name: copy files over over to /etc/suricata
    command: chdir=/home/dakota/SecurityPostureAssessment/suricata-5.0.0 cp suricata.yaml.in /etc/suricata

  - name: Set up suricata repository
    apt_repository:
        repo: ppa:oisf/suricata-stable

  - name: install suricata
    apt:
      update_cache: yes
      name: suricata
      state: present
  
  - name: start suricata
    command: chdir=/home/dakota/SecurityPostureAssessment systemctl start suricata
